<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title></title>
  <style>
    body{
      font-family: 'Helvetica Neue', Helvetica, sans-serif;
    }

    p{
      font-size: 10pt;
      margin-left:20px;
    }
    .countries{
      stroke: #fff;
    }
    .legend rect{
      stroke: #000;
    }

    .legend, .legend_title text{
      font-size:10pt;
    }

    .barlabel {
      font-size:8pt;
      text-anchor: middle;

    }
      
      #legend-title {
        font-weight: bold;
        font-size: 12pt;
      }
      
      text {
          font-weight: bold;
      }
      
  </style>
</head>

<body>
  <script src="https://d3js.org/d3.v4.min.js"></script>
  <script src="https://d3js.org/topojson.v2.min.js"></script>
  <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
  <script src="https://d3js.org/d3-geo-projection.v1.min.js"></script>
  <script src="functions.js"></script>
    <center><h2>EBAS Data Access by User Country (# Datasets) - All Frameworks</h2><p>Traffic identified as NILU internal or EU are not included in the map. NILU internal is traffic related to testing an internal use of the database. EU traffic is traffic from the European Commission.</p></center>
  <script>

    /// params

    var color_na = d3.rgb("#bdbdbd");
    // only works if array.length-1 is between 3 and 9 (d3 color scheme)
    var quantiles = [0, 0.2, 0.4, 0.6, 0.8, 1];
    var init_year = 2017;
    var headline = "";


    // init map container, projection
    var width = 1360, height = 725;
    var svg_map = d3.select("body").insert("svg")
                  .attr("id", "map")
                  .attr("height", height)
                  .attr("width", width);
    var path = d3.geoPath(d3.geoRobinson().scale(220).translate( [width / 2, height / 2]));


      
    // init legend container
    svg_map.append("g")
        .attr("class", "legend");
    svg_map.append("g")
        .attr("class", "legend_title")
        .append("text");

    // init bars container
    var margin = {top: 50, right:10, bottom:50, left:30};
    var svgBarsWidth = 3060 - margin.left - margin.right,
        svgBarsHeight = 300 - margin.top - margin.bottom;

    var x = d3.scaleBand()
                .rangeRound([0, svgBarsWidth])
                .padding(.3);
    var y = d3.scaleLinear().range([svgBarsHeight, 0]);

    var svg_bars = d3.select("body")
        .append("svg")
          .attr("id", "bars")
          .attr("width", svgBarsWidth + margin.left + margin.right)
          .attr("height", svgBarsHeight + margin.top + margin.bottom)
        .append("g")
          .attr("class", "bars")
          .attr("transform", "translate(" + margin.left + ", " + margin.top + ")");

    // load data
    d3.json("data/data.json", function(error, d) {

      if (error) throw error;

      let data_all = d['number_of_unique_users'];
      
      let data = data_all[init_year];
      let color = calcColorScale(data);

    console.log(color);
        
      // load map data and render it
      d3.json("data/world.json", function(error, worldmap) {
        if (error) throw error;

        // init map
        svg_map.append("g")
          .attr("class", "countries")
          .selectAll("path")
          .data(topojson.feature(worldmap, worldmap.objects.world).features)
          .enter().append("path")
            .attr("d", path)
            .attr("id", function(d) { return d.id; })
            .call(fillMap, color, data)
          .append("title")
            .call(setPathTitle, data);

        // init legend
        renderLegend(color, data);
        renderBars(color, data);
      }); // map data


    }); 

  </script>
</body>
</html>
